---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

// Format date from YYYY-MM-DD to "Nov 12, 2025"
function formatEventDate(dateString: string): string {
  const date = new Date(dateString + "T00:00:00"); // Add time to avoid timezone issues
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}

// Social media links
const socialLinks = [
  { name: "Twitter", url: "https://twitter.com/shinjipons" },
  { name: "GitHub", url: "https://github.com/shinjipons" },
  { name: "LinkedIn", url: "https://linkedin.com/in/shinjipons" },
  { name: "Figma", url: "https://www.figma.com/@shinjipons" },
  { name: "Instagram", url: "https://www.instagram.com/shinji.pons" },
  { name: "Cal.com", url: "https://cal.com/shinjipons/" },
];

// Work experience
const workExperience = [
  {
    company: "Formlabs",
    role: "Product designer",
    period: "2025—",
    url: "https://formlabs.com/",
  },
  {
    company: "Modyfi",
    role: "Product designer",
    period: "2024",
    url: "https://www.modyfi.com/",
  },
  {
    company: "Ragdoll Dynamics",
    role: "Product designer",
    period: "2023—24",
    url: "https://ragdolldynamics.com/",
  },
  {
    company: "Frostbite",
    role: "Product designer",
    period: "2022—23",
    url: "https://www.ea.com/frostbite",
  },
  {
    company: "LEGO",
    role: "Product designer",
    period: "2019—21",
    url: "https://www.lego.com/",
  },
  {
    company: "Autodesk",
    role: "Product designer",
    period: "2017—19",
    url: "https://www.autodesk.com/",
  },
  {
    company: "Thomson Reuters",
    role: "Product designer",
    period: "2016—17",
    url: "https://www.thomsonreuters.com/",
  },
  {
    company: "Microsoft",
    role: "UX designer",
    period: "2015",
    url: "https://www.microsoft.com/",
  },
  {
    company: "Barnbrook",
    role: "Design intern",
    period: "2015",
    url: "https://www.barnbrook.net/",
  },
  {
    company: "Total Design",
    role: "Design intern",
    period: "2013",
    url: "https://designlaboratory.co.uk/",
  },
  {
    company: "The Design Lab",
    role: "Design intern",
    period: "2014",
    url: "https://www.totaldesign.com/",
  },
  {
    company: "Ateliers Jean Nouvel",
    role: "Design intern",
    period: "2012",
    url: "https://www.jeannouvel.com/",
  },
];

// Work projects (most proud projects)
const workProjects = [
  {
    name: "PreForm by Formlabs",
    description: "from version 3.51 onwards",
    url: "https://formlabs.com/software/preform/",
  },
  {
    name: "Ragdoll Standalone",
    description: "Animating with physics in Maya, Blender and beyond",
    url: "https://ragdolldynamics.com/",
  },
  {
    name: "Modyfi",
    description: "Confidential",
    url: "https://www.modyfi.com/",
  },
  {
    name: "Frostbite",
    description: "Confidential",
    url: "https://www.ea.com/frostbite",
  },
  {
    name: "LEGO Digital Designer Pro",
    description: "Confidential",
    url: "https://www.lego.com/",
  },
  {
    name: "Autodesk Alias SubD",
    description: "Designing subdivision modelling tools for Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Dynamo for Alias",
    description: "Adding computational design to Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Louvre Abu Dhabi",
    description: "Museum icon design and typography",
    url: "https://www.jeannouvel.com/projets/louvre-abou-dhabi-3/",
  },
];

// Side projects
const sideProjects = [
  {
    name: "Select Parent Component",
    description:
      "Figma plugin to grab the component wrapping the user selection",
    url: "https://github.com/shinjipons/Select-Parent-Component",
  },
  {
    name: "Time Lens",
    description: "Blender add-on for automating editor screenshots",
    url: "https://github.com/shinjipons/Time-Lens",
  },
  {
    name: "Modulo",
    description: "Family of 168 grid-based typefaces",
    url: "https://github.com/shinjipons/modulo-typeface",
  },
  {
    name: "InDesign Scripting",
    description: "Automating Adobe InDesign using basil.js",
    url: "https://github.com/shinjipons/basiljs-scripts",
  },
];

// Upcoming events and meetups
const upcomingEventsRaw = [
  {
    title: "ProductTank Watch Party",
    destination: "Budapest",
    date: "2025-11-12",
    url: "https://luma.com/2ypljyz1?tk=a7drVs",
  },
  {
    title: "UX Budapest Meetup",
    destination: "Budapest",
    date: "2025-11-27",
    url: "https://luma.com/shp07hsi?tk=lMh8V7",
  },
];

// Format dates for display and filter out past events
const today = new Date();
today.setHours(0, 0, 0, 0); // Set to start of day for accurate comparison

const upcomingEvents = upcomingEventsRaw
  .filter((event) => {
    if (!event.date) return true; // Keep events without dates
    const eventDate = new Date(event.date + "T00:00:00");
    eventDate.setHours(0, 0, 0, 0);
    return eventDate >= today; // Only include today and future events
  })
  .map((event) => ({
    ...event,
    date: event.date ? formatEventDate(event.date) : undefined,
  }));

// Get all blog posts dynamically and sort by date (newest first)
const allPosts = await getCollection("writing");
const blogPosts = allPosts.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Experiments
const experiments = [
  {
    url: "https://spinbox-prototype.shinjipons.com",
    imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
    imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  },
  // {
  //   url: "https://3d-measure.shinjipons.com",
  //   imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
  //   imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  // },
];

// Navigation sections
const navSections = [
  { id: "events", label: "Events" },
  { id: "writing", label: "Writing" },
  { id: "experience", label: "Work Experience" },
  { id: "projects", label: "Projects" },
  { id: "side-projects", label: "Side Projects" },
  { id: "experiments", label: "Experiments" },
];
---

<BaseLayout title="Shinji Pons" description="Personal website">
  <div class="max-w-[560px] mx-auto px-4 py-12">
    <!-- Header section -->
    <section class="pt-8 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 px-4">
        Shinji Pons
      </h2>
      <p class="px-4 text-stone-500 dark:text-stone-300">Product Designer</p>
    </section>

    <!-- Today section -->
    <section class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 px-4 pb-4">
        Today
      </h2>
      <p class="px-4 text-stone-800 dark:text-stone-100 mb-4">
        I work on software product design at <a
          href="https://formlabs.com/"
          class="text-stone-800 dark:text-stone-100">Formlabs</a
        >.
      </p>
      <p class="px-4 text-stone-800 dark:text-stone-100 mb-4">
        My ambition is to craft 3D tools and workflows that incite artists,
        engineers and designers to accomplish greater things.
      </p>
      <p class="px-4 text-stone-800 dark:text-stone-100 mb-4">
        You can reach out to me on{" "}
        <span
          set:html={socialLinks
            .map(
              (link, index) =>
                (index > 0
                  ? index === socialLinks.length - 1
                    ? " and "
                    : ", "
                  : "") +
                `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="text-stone-800 dark:text-stone-100">${link.name.trim()}</a>`
            )
            .join("")}
        />.
      </p>
      <p class="px-4 text-stone-800 dark:text-stone-100">
        A few things to explore:
      </p>
      <ul class="px-4 mt-4 space-y-1 list-disc list-inside">
        {
          navSections.map((section) => (
            <li class="text-stone-800 dark:text-stone-100">
              <a
                href={`#${section.id}`}
                class="nav-link inline font-regular text-stone-800 dark:text-stone-100"
              >
                {section.label}
              </a>
            </li>
          ))
        }
      </ul>
    </section>

    <!-- Events Section -->
    <section id="events" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Events I'm Attending
      </h2>
      {
        upcomingEvents.length > 0 ? (
          <div class="space-y-6">
            {upcomingEvents.map((event, index) => (
              <div class="px-4 flex flex-col gap-1 md:flex-row md:justify-between md:items-center md:gap-0">
                <p class="text-stone-800 dark:text-stone-100">
                  {event.url ? (
                    <a
                      href={event.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="font-medium hover:text-amber-400 dark:hover:text-amber-400 transition-color-hover"
                    >
                      {event.title || event.destination}
                    </a>
                  ) : (
                    <span class="font-medium">
                      {event.title || event.destination}
                    </span>
                  )}
                </p>
                <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-0">
                  {event.destination && (
                    <p class="text-stone-500 dark:text-stone-300">
                      {event.destination}
                    </p>
                  )}
                  {event.date && (
                    <p class="text-stone-500 dark:text-stone-400 md:w-32 md:text-right">
                      {event.date}
                    </p>
                  )}
                </div>
              </div>
            ))}
          </div>
        ) : (
          <p class="px-4 text-stone-500 dark:text-stone-300">
            No upcoming events scheduled...
          </p>
        )
      }
    </section>

    <!-- Blog Posts Section -->
    <section id="writing" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Writing
      </h2>
      {
        blogPosts.length > 0 ? (
          <div class="space-y-2">
            {blogPosts.map((post, index) => (
              <a
                href={`/writing/${post.slug}`}
                class="block rounded-lg pt-4 px-4 pb-2 bg-transparent hover:bg-stone-50 dark:hover:bg-stone-800 hover:shadow-[0_8px_12px_0_rgba(0,0,0,0.08),0_0_1px_0_rgba(0,0,0,0.62)] transition-all duration-200"
              >
                <article>
                  <h3 class="font-medium text-stone-800 dark:text-stone-100 mb-2">
                    {post.data.title}
                  </h3>
                  <p class="text-stone-500 dark:text-stone-400 mb-2">
                    {post.data.description}
                  </p>
                </article>
              </a>
            ))}
          </div>
        ) : (
          <p class="px-4 text-stone-500 dark:text-stone-300">
            Check back soon...
          </p>
        )
      }
    </section>

    <!-- Work Experience Section -->
    <section id="experience" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Work Experience
      </h2>
      <div class="space-y-6">
        {
          workExperience.map((job, index) => (
            <div class="px-4 flex flex-col gap-1 md:flex-row md:justify-between md:items-center md:gap-0">
              <p class="text-stone-800 dark:text-stone-100">
                {job.url ? (
                  <a
                    href={job.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="font-medium hover:text-amber-400 dark:hover:text-amber-400 transition-color-hover"
                  >
                    {job.company}
                  </a>
                ) : (
                  <span class="font-medium">{job.company}</span>
                )}
              </p>
              <div class="flex flex-col gap-1 md:flex-row md:items-center md:gap-0">
                <p class="text-stone-500 dark:text-stone-300">{job.role}</p>
                <p class="text-stone-500 dark:text-stone-400 md:w-32 md:text-right">
                  {job.period}
                </p>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Work Projects Section -->
    <section id="projects" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Projects
      </h2>
      <div class="grid gap-2 grid-cols-1">
        {
          workProjects.map((project, index) => (
            <a
              href={project.url}
              target="_blank"
              rel="noopener noreferrer"
              class="block rounded-lg pt-4 px-4 pb-2 bg-transparent hover:bg-stone-50 dark:hover:bg-stone-800 hover:shadow-[0_8px_12px_0_rgba(0,0,0,0.08),0_0_1px_0_rgba(0,0,0,0.62)] transition-all duration-200"
            >
              <h3 class="font-medium text-stone-800 dark:text-stone-100 mb-2">
                {project.name}
              </h3>
              <p class="text-stone-500 dark:text-stone-400 mb-2">
                {project.description}
              </p>
            </a>
          ))
        }
      </div>
    </section>

    <!-- Side Projects Section -->
    <section id="side-projects" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Side Projects
      </h2>
      <div class="grid gap-2 grid-cols-1">
        {
          sideProjects.map((project, index) => (
            <a
              href={project.url}
              target="_blank"
              rel="noopener noreferrer"
              class="block rounded-lg pt-4 px-4 pb-2 bg-transparent hover:bg-stone-50 dark:hover:bg-stone-800 hover:shadow-[0_8px_12px_0_rgba(0,0,0,0.08),0_0_1px_0_rgba(0,0,0,0.62)] transition-all duration-200"
            >
              <h3 class="font-medium text-stone-800 dark:text-stone-100 mb-2">
                {project.name}
              </h3>
              <p class="text-stone-500 dark:text-stone-400 mb-2">
                {project.description}
              </p>
            </a>
          ))
        }
      </div>
    </section>

    <!-- Experiments Section -->
    <section id="experiments" class="pt-12 pb-8">
      <h2 class="font-semibold text-stone-800 dark:text-stone-100 mb-6 px-4">
        Experiments
      </h2>
      {
        experiments.length > 0 ? (
          <div class="grid gap-[12px] grid-cols-1 px-4">
            {experiments.map((experiment, index) => {
              // Every 3rd item (index 2, 5, 8, ...) spans full width (every second row)
              const isFullWidth = index % 3 === 2;
              return (
                <a
                  href={experiment.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class={`block rounded-[6px] overflow-hidden bg-transparent hover:bg-stone-50 dark:bg-transparent dark:hover:bg-stone-800 hover:shadow-[0_8px_12px_0_rgba(0,0,0,0.08),0_0_1px_0_rgba(0,0,0,0.62)] transition-all duration-200 ${isFullWidth ? "col-span-2" : ""}`}
                >
                  <img
                    src={experiment.imageLight}
                    class="w-full aspect-square object-cover dark:hidden dark:!bg-transparent"
                  />
                  <img
                    src={experiment.imageDark}
                    class="hidden w-full aspect-square object-cover dark:block dark:!bg-transparent"
                  />
                </a>
              );
            })}
          </div>
        ) : (
          <p class="px-4 text-stone-500 dark:text-stone-300">Coming soon...</p>
        )
      }
    </section>
  </div>
</BaseLayout>
