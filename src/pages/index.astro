---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

// Upcoming events and meetups
const upcomingEventsRaw = [
  {
    title: "ProductTank Watch Party",
    destination: "Budapest",
    date: "2025-11-12",
    url: "https://luma.com/2ypljyz1?tk=a7drVs",
  },
  {
    title: "UX Budapest Meetup",
    destination: "Budapest",
    date: "2025-11-27",
    url: "https://luma.com/shp07hsi?tk=lMh8V7",
  },
  {
    title: "DevBP #11: Crash, Learn and Laugh",
    destination: "Budapest",
    date: "2025-12-03",
    url: "https://www.meetup.com/devbp-meetup/events/311991887/",
  },
];

// Format date from YYYY-MM-DD to "Nov 12, 2025"
function formatEventDate(dateString: string): string {
  const date = new Date(dateString + "T00:00:00"); // Add time to avoid timezone issues
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}

// Social media links
const socialLinks = [
  { name: "Twitter", url: "https://twitter.com/shinjipons" },
  { name: "GitHub", url: "https://github.com/shinjipons" },
  { name: "LinkedIn", url: "https://linkedin.com/in/shinjipons" },
  { name: "Figma", url: "https://www.figma.com/@shinjipons" },
  { name: "Instagram", url: "https://www.instagram.com/shinji.pons" },
  { name: "Cal.com", url: "https://cal.com/shinjipons/" },
];

// Work experience
const workExperience = [
  {
    company: "Formlabs",
    role: "Product designer",
    period: "2025—",
    url: "https://formlabs.com/",
  },
  {
    company: "Modyfi",
    role: "Product designer",
    period: "2024",
    url: "https://www.modyfi.com/",
  },
  {
    company: "Ragdoll Dynamics",
    role: "Product designer",
    period: "2023—24",
    url: "https://ragdolldynamics.com/",
  },
  {
    company: "Frostbite",
    role: "Product designer",
    period: "2022—23",
    url: "https://www.ea.com/frostbite",
  },
  {
    company: "LEGO",
    role: "Product designer",
    period: "2019—21",
    url: "https://www.lego.com/",
  },
  {
    company: "Autodesk",
    role: "Product designer",
    period: "2017—19",
    url: "https://www.autodesk.com/",
  },
  {
    company: "Thomson Reuters",
    role: "Product designer",
    period: "2016—17",
    url: "https://www.thomsonreuters.com/",
  },
  {
    company: "Microsoft",
    role: "UX designer",
    period: "2015",
    url: "https://www.microsoft.com/",
  },
  {
    company: "Barnbrook",
    role: "Design intern",
    period: "2015",
    url: "https://www.barnbrook.net/",
  },
  {
    company: "Total Design",
    role: "Design intern",
    period: "2013",
    url: "https://designlaboratory.co.uk/",
  },
  {
    company: "The Design Lab",
    role: "Design intern",
    period: "2014",
    url: "https://www.totaldesign.com/",
  },
  {
    company: "Ateliers Jean Nouvel",
    role: "Design intern",
    period: "2012",
    url: "https://www.jeannouvel.com/",
  },
];

// Work projects (most proud projects)
const workProjects = [
  {
    name: "PreForm by Formlabs",
    description: "from version 3.51 onwards",
    url: "https://formlabs.com/software/preform/",
  },
  {
    name: "Ragdoll Standalone",
    description: "Animating with physics in Maya, Blender and beyond",
    url: "https://ragdolldynamics.com/",
  },
  {
    name: "Modyfi",
    description: "Confidential",
    url: "https://www.modyfi.com/",
  },
  {
    name: "Frostbite",
    description: "Confidential",
    url: "https://www.ea.com/frostbite",
  },
  {
    name: "LEGO Digital Designer Pro",
    description: "Confidential",
    url: "https://www.lego.com/",
  },
  {
    name: "Autodesk Alias SubD",
    description: "Designing subdivision modelling tools for Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Dynamo for Alias",
    description: "Adding computational design to Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Louvre Abu Dhabi",
    description: "Museum icon design and typography",
    url: "https://www.jeannouvel.com/projets/louvre-abou-dhabi-3/",
  },
];

// Side projects
const sideProjects = [
  {
    name: "Select Parent Component",
    description:
      "Figma plugin to grab the component wrapping the user selection",
    url: "https://github.com/shinjipons/Select-Parent-Component",
  },
  {
    name: "Time Lens",
    description: "Blender add-on for automating editor screenshots",
    url: "https://github.com/shinjipons/Time-Lens",
  },
  {
    name: "Modulo",
    description: "Family of 168 grid-based typefaces",
    url: "https://github.com/shinjipons/modulo-typeface",
  },
  {
    name: "InDesign Scripting",
    description: "Automating Adobe InDesign using basil.js",
    url: "https://github.com/shinjipons/basiljs-scripts",
  },
];

// Format dates for display and filter out past events
const today = new Date();
today.setHours(0, 0, 0, 0); // Set to start of day for accurate comparison

const upcomingEvents = upcomingEventsRaw
  .filter((event) => {
    if (!event.date) return true; // Keep events without dates
    const eventDate = new Date(event.date + "T00:00:00");
    eventDate.setHours(0, 0, 0, 0);
    return eventDate >= today; // Only include today and future events
  })
  .map((event) => ({
    ...event,
    date: event.date ? formatEventDate(event.date) : undefined,
  }));

// Get all blog posts dynamically and sort by date (newest first)
const allPosts = await getCollection("writing");
const blogPosts = allPosts.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Experiments
const experiments = [
  {
    url: "https://spinbox-prototype.shinjipons.com",
    imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
    imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  },
  // {
  //   url: "https://3d-measure.shinjipons.com",
  //   imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
  //   imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  // },
];

// Navigation sections
const navSections = [
  { id: "events", label: "Events" },
  { id: "writing", label: "Writing" },
  { id: "experience", label: "Work Experience" },
  { id: "projects", label: "Projects" },
  { id: "side-projects", label: "Side Projects" },
  { id: "experiments", label: "Experiments" },
];
---

<BaseLayout title="Shinji Pons" description="Personal website">
  <div class="container">
    <!-- Header section -->
    <section>
      <h2>Shinji Pons</h2>
      <p>Product Designer</p>
    </section>

    <!-- Today section -->
    <section>
      <h2>Today</h2>
      <p>
        I am a product designer at <a href="https://formlabs.com/">Formlabs</a>.
      </p>
      <p>
        My ambition is to craft 3D tools and workflows that incite artists,
        engineers and designers to accomplish greater things.
      </p>
      <p>
        You can reach out to me on{" "}
        <span
          set:html={socialLinks
            .map(
              (link, index) =>
                (index > 0
                  ? index === socialLinks.length - 1
                    ? " and "
                    : ", "
                  : "") +
                `<a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.name.trim()}</a>`
            )
            .join("")}
        />.
      </p>
      <p>A few things to explore:</p>
      <ul>
        {
          navSections.map((section) => (
            <li>
              <a href={`#${section.id}`}>{section.label}</a>
            </li>
          ))
        }
      </ul>
    </section>

    <!-- Events Section -->
    <section id="events">
      <h2>Events I'm Going To</h2>
      {
        upcomingEvents.length > 0 ? (
          <div>
            {upcomingEvents.map((event, index) => (
              <div>
                <p>
                  {event.url ? (
                    <a
                      href={event.url}
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      {event.title || event.destination}
                    </a>
                  ) : (
                    <span>{event.title || event.destination}</span>
                  )}
                </p>
                <div>
                  {event.destination && <p>{event.destination}</p>}
                  {event.date && <p>{event.date}</p>}
                </div>
              </div>
            ))}
          </div>
        ) : (
          <p>No upcoming events scheduled...</p>
        )
      }
    </section>

    <!-- Blog Posts Section -->
    <section id="writing">
      <h2>Writing</h2>
      {
        blogPosts.length > 0 ? (
          <div>
            {blogPosts.map((post, index) => (
              <a href={`/writing/${post.slug}`}>
                <article>
                  <h3>{post.data.title}</h3>
                  <p>{post.data.description}</p>
                </article>
              </a>
            ))}
          </div>
        ) : (
          <p>Check back soon...</p>
        )
      }
    </section>

    <!-- Work Experience Section -->
    <section id="experience">
      <h2>Work Experience</h2>
      <div>
        {
          workExperience.map((job, index) => (
            <div>
              <p>
                {job.url ? (
                  <a href={job.url} target="_blank" rel="noopener noreferrer">
                    {job.company}
                  </a>
                ) : (
                  <span>{job.company}</span>
                )}
              </p>
              <div>
                <p>{job.role}</p>
                <p>{job.period}</p>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Work Projects Section -->
    <section id="projects">
      <h2>Projects</h2>
      <div>
        {
          workProjects.map((project, index) => (
            <a href={project.url} target="_blank" rel="noopener noreferrer">
              <h3>{project.name}</h3>
              <p>{project.description}</p>
            </a>
          ))
        }
      </div>
    </section>

    <!-- Side Projects Section -->
    <section id="side-projects">
      <h2>Side Projects</h2>
      <div>
        {
          sideProjects.map((project, index) => (
            <a href={project.url} target="_blank" rel="noopener noreferrer">
              <h3>{project.name}</h3>
              <p>{project.description}</p>
            </a>
          ))
        }
      </div>
    </section>

    <!-- Experiments Section -->
    <section id="experiments">
      <h2>Experiments</h2>
      {
        experiments.length > 0 ? (
          <div>
            {experiments.map((experiment, index) => {
              // Every 3rd item (index 2, 5, 8, ...) spans full width (every second row)
              const isFullWidth = index % 3 === 2;
              return (
                <a
                  href={experiment.url}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <img src={experiment.imageLight} />
                  <img src={experiment.imageDark} />
                </a>
              );
            })}
          </div>
        ) : (
          <p>Coming soon...</p>
        )
      }
    </section>
  </div>
</BaseLayout>
