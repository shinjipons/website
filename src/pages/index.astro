---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

// Upcoming events and meetups
const upcomingEventsRaw = [
  {
    title: "ProductTank Watch Party",
    destination: "Budapest",
    date: "2025-11-12",
    url: "https://luma.com/2ypljyz1?tk=a7drVs",
  },
];

// Format date from YYYY-MM-DD to "Nov 12, 2025"
function formatEventDate(dateString: string): string {
  const date = new Date(dateString + "T00:00:00"); // Add time to avoid timezone issues
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}

// Social media links
const socialLinks = [
  { name: "Resume", url: "/resume-shinji-pons.pdf" },
  { name: "Twitter", url: "https://twitter.com/shinjipons" },
  { name: "LinkedIn", url: "https://linkedin.com/in/shinjipons" },
  { name: "Figma", url: "https://www.figma.com/@shinjipons" },
  { name: "Cal.com", url: "https://cal.com/shinjipons/" },
];

// Work experience
const workExperience = [
  {
    company: "Formlabs",
    role: "Product designer",
    period: "2025 — Present",
    url: "https://formlabs.com/",
  },
  {
    company: "Modyfi",
    role: "Product designer",
    period: "2024",
    url: "https://www.modyfi.com/",
  },
  {
    company: "Ragdoll Dynamics",
    role: "Product designer",
    period: "2023 — 2024",
    url: "https://ragdolldynamics.com/",
  },
  {
    company: "Frostbite",
    role: "Product designer",
    period: "2022 — 2023",
    url: "https://www.ea.com/frostbite",
  },
  {
    company: "LEGO",
    role: "Product designer",
    period: "2019 — 2021",
    url: "https://www.lego.com/",
  },
  {
    company: "Autodesk",
    role: "Product designer",
    period: "2017 — 2019",
    url: "https://www.autodesk.com/",
  },
  {
    company: "Thomson Reuters",
    role: "Product designer",
    period: "2016 — 2017",
    url: "https://www.thomsonreuters.com/",
  },
  {
    company: "Microsoft",
    role: "UX designer",
    period: "2015",
    url: "https://www.microsoft.com/",
  },
  {
    company: "Barnbrook",
    role: "Design intern",
    period: "2015",
    url: "https://www.barnbrook.net/",
  },
  {
    company: "The Design Lab",
    role: "Design intern",
    period: "2014",
    url: "https://www.totaldesign.com/",
  },
  {
    company: "Total Design",
    role: "Design intern",
    period: "2013",
    url: "https://designlaboratory.co.uk/",
  },
  {
    company: "Ateliers Jean Nouvel",
    role: "Design intern",
    period: "2012",
    url: "https://www.jeannouvel.com/",
  },
];

// Work projects (most proud projects)
const workProjects = [
  {
    name: "PreForm by Formlabs",
    description: "from version 3.51 onwards",
    url: "https://formlabs.com/software/preform/",
  },
  {
    name: "Ragdoll Standalone",
    description: "Animating with physics in Maya, Blender... and more",
    url: "https://ragdolldynamics.com/",
  },
  {
    name: "Modyfi",
    description: "Confidential",
    url: "https://www.modyfi.com/",
  },
  {
    name: "Frostbite",
    description: "Confidential",
    url: "https://www.ea.com/frostbite",
  },
  {
    name: "LEGO Digital Designer Pro",
    description: "Confidential",
    url: "https://www.lego.com/",
  },
  {
    name: "Autodesk Alias SubD",
    description: "Designing subdivision modelling tools for Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Dynamo for Alias",
    description: "Adding computational design to Alias",
    url: "https://autodesk.com/alias",
  },
  {
    name: "Louvre Abu Dhabi",
    description: "Supergraphics and icon design",
    url: "https://www.jeannouvel.com/projets/louvre-abou-dhabi-3/",
  },
];

// Side projects
const sideProjects = [
  {
    name: "Select Parent Component",
    description: "Figma plugin that locates the closest component to the selection",
    url: "https://github.com/shinjipons/Select-Parent-Component",
  },
  {
    name: "Time Lens",
    description: "Blender add-on for automating editor screenshots",
    url: "https://github.com/shinjipons/Time-Lens",
  },
  {
    name: "Modulo",
    description: "Family of 168 grid-based typefaces",
    url: "https://github.com/shinjipons/modulo-typeface",
  },
  {
    name: "InDesign Scripting",
    description: "Automating Adobe InDesign using basil.js",
    url: "https://github.com/shinjipons/basiljs-scripts",
  },
];

// Format dates for display and filter out past events
const today = new Date();
today.setHours(0, 0, 0, 0); // Set to start of day for accurate comparison

const upcomingEvents = upcomingEventsRaw
  .filter((event) => {
    if (!event.date) return true; // Keep events without dates
    const eventDate = new Date(event.date + "T00:00:00");
    eventDate.setHours(0, 0, 0, 0);
    return eventDate >= today; // Only include today and future events
  })
  .map((event) => ({
    ...event,
    date: event.date ? formatEventDate(event.date) : undefined,
  }));

// Get all blog posts dynamically and sort by date (newest first)
const allPosts = await getCollection("writing");
const blogPosts = allPosts.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Experiments
const experiments = [
  {
    title: "Input Field",
    description: "Slider with spinbox design prototype",
    url: "https://spinbox-prototype.shinjipons.com",
    imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
    imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  },
  // {
  //   title: "3D Measure",
  //   description: "Description here",
  //   url: "https://3d-measure.shinjipons.com",
  //   imageLight: "/media/experiments/spinbox-prototype-light-mode.png",
  //   imageDark: "/media/experiments/spinbox-prototype-dark-mode.png",
  // },
];
---

<BaseLayout title="Shinji Pons" description="Personal website">
  <div class="container">

    <!-- Header section -->
    <section>
      <h1>Shinji Pons</h1>
      <p>Product Designer</p>
    </section>

    <!-- Today section -->
    <section>
      <h1>Today</h1>
      <p>I am a product designer at <a href="https://formlabs.com/">Formlabs</a>.</p>
      <p>I empower artists, engineers and designers with tools and workflows that spark bolder creations.</p>
      <p>
        <span
          set:html={socialLinks
            .map(
              (link, index) =>
                (index > 0 ? " " : "") +
                `<a class="social-link-item" href="${link.url}" target="_blank" rel="noopener noreferrer">${link.name.trim()}</a>`
            )
            .join("")}
        />
      </p>
    </section>

    <!-- Events Section -->
    <section id="events">
      <h1>Events</h1>
      {
        upcomingEvents.length > 0 ? (
          <div>
            {upcomingEvents.map((event, index) => (
              event.url ? (
                <a href={event.url} target="_blank" rel="noopener noreferrer" class="event-card">
                  <h2>{event.title || event.destination}</h2>
                  <div class="event-card-description">
                    {event.destination && <p>{event.destination}</p>}
                    {event.date && <p>{event.date}</p>}
                  </div>
                </a>
              ) : (
                <div class="event-card">
                  <h2>{event.title || event.destination}</h2>
                  <div class="event-card-description">
                    {event.destination && <p>{event.destination}</p>}
                    {event.date && <p>{event.date}</p>}
                  </div>
                </div>
              )
            ))}
          </div>
        ) : (
          <p>Nothing scheduled</p>
        )
      }
    </section>

    <!-- Blog Posts Section -->
    <section id="writing">
      <h1>Writing</h1>
      {
        blogPosts.length > 0 ? (
          <div>
            {blogPosts.map((post, index) => (
              <a href={`/writing/${post.slug}`} class="blog-card">
                <h3>{post.data.title}</h3>
                <p>{post.data.description}</p>
              </a>
            ))}
          </div>
        ) : (
          <p>Check back soon...</p>
        )
      }
    </section>

    <!-- Work Experience Section -->
    <section id="experience">
      <h1>Work Experience</h1>
      <div>
        {
          workExperience.map((job, index) => (
            <div class="work-experience-card">
              <p>
                {job.url ? (
                  <a href={job.url} target="_blank" rel="noopener noreferrer">{job.company}</a>
                ) : (
                  <span>{job.company}</span>
                )}
              </p>
              <div class="work-experience-card-description">
                <p>{job.role}</p>
                <p>{job.period}</p>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Work Projects Section -->
    <section id="projects">
      <h1>Projects</h1>
      {
        workProjects.length > 0 ? (
          <div>
            {workProjects.map((project, index) => (
              <a href={project.url} target="_blank" rel="noopener noreferrer" class="blog-card">
                <h3>{project.name}</h3>
                <p>{project.description}</p>
              </a>
            ))}
          </div>
        ) : (
          <p>Check back soon...</p>
        )
      }
    </section>

    <!-- Side Projects Section -->
    <section id="side-projects">
      <h1>Side Projects</h1>
      {
        sideProjects.length > 0 ? (
          <div>
            {sideProjects.map((project, index) => (
              <a href={project.url} target="_blank" rel="noopener noreferrer" class="blog-card">
                <h3>{project.name}</h3>
                <p>{project.description}</p>
              </a>
            ))}
          </div>
        ) : (
          <p>Check back soon...</p>
        )
      }
    </section>

    <!-- Experiments Section -->
    <section id="experiments">
      <h1>Experiments</h1>
      {
        experiments.length > 0 ? (
          <div>
            {experiments.map((experiment) => {
              return (
                <a href={experiment.url} target="_blank" rel="noopener noreferrer" class="experiment-card">
                  <img src={experiment.imageLight} class="experiment-image-light" />
                  <img src={experiment.imageDark} class="experiment-image-dark" />
                  <div class="experiment-card-description">
                    <div class="experiment-card-description-text">
                      <h2>{experiment.title}</h2>
                      <p>{experiment.description}</p>
                    </div>
                    <button>
                      Play
                      <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M4.5 3L8.5 6L4.5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </a>
              );
            })}
          </div>
        ) : (
          <p>Coming soon...</p>
        )
      }
    </section>

    <!-- Archive and scraps section -->
    <section id="archive-and-scraps">
      <h1>Archive and Scraps</h1>
      <div>
        <p>Nothing here yet...</p>
      </div>
    </section>
  </div>
</BaseLayout>
